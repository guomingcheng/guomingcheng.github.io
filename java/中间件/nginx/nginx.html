<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>下载与安装 | 文档</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/index.css">
    <script src="/js/index.js"></script>
    <meta name="description" content="个人文档">
    
    <link rel="preload" href="/assets/css/0.styles.8cd2006c.css" as="style"><link rel="preload" href="/assets/js/app.ce1393de.js" as="script"><link rel="preload" href="/assets/js/2.ee68cb5d.js" as="script"><link rel="preload" href="/assets/js/12.aa5ec6e6.js" as="script"><link rel="prefetch" href="/assets/js/10.fae9557b.js"><link rel="prefetch" href="/assets/js/11.ec03d5d9.js"><link rel="prefetch" href="/assets/js/13.fa27dbe3.js"><link rel="prefetch" href="/assets/js/14.27428945.js"><link rel="prefetch" href="/assets/js/15.e19dc613.js"><link rel="prefetch" href="/assets/js/16.ac5d0041.js"><link rel="prefetch" href="/assets/js/17.b015baa0.js"><link rel="prefetch" href="/assets/js/18.d790bc9c.js"><link rel="prefetch" href="/assets/js/19.7f450609.js"><link rel="prefetch" href="/assets/js/20.504a3fd4.js"><link rel="prefetch" href="/assets/js/21.fcc0c1f7.js"><link rel="prefetch" href="/assets/js/22.1e27d5c1.js"><link rel="prefetch" href="/assets/js/23.e7de804c.js"><link rel="prefetch" href="/assets/js/24.89d96b41.js"><link rel="prefetch" href="/assets/js/25.47d860f4.js"><link rel="prefetch" href="/assets/js/26.03bbdba6.js"><link rel="prefetch" href="/assets/js/27.adba25d3.js"><link rel="prefetch" href="/assets/js/28.51f6ec86.js"><link rel="prefetch" href="/assets/js/29.3d75e6eb.js"><link rel="prefetch" href="/assets/js/3.af3b0f40.js"><link rel="prefetch" href="/assets/js/30.3ea92647.js"><link rel="prefetch" href="/assets/js/31.50e89190.js"><link rel="prefetch" href="/assets/js/32.2330f5a5.js"><link rel="prefetch" href="/assets/js/33.3db8ae98.js"><link rel="prefetch" href="/assets/js/34.b38625c8.js"><link rel="prefetch" href="/assets/js/35.49492a46.js"><link rel="prefetch" href="/assets/js/36.5a949c11.js"><link rel="prefetch" href="/assets/js/37.e1595cca.js"><link rel="prefetch" href="/assets/js/38.5e66f157.js"><link rel="prefetch" href="/assets/js/39.e118d131.js"><link rel="prefetch" href="/assets/js/4.dcedff1a.js"><link rel="prefetch" href="/assets/js/40.9b43fbc7.js"><link rel="prefetch" href="/assets/js/41.d9116c83.js"><link rel="prefetch" href="/assets/js/42.95c96c90.js"><link rel="prefetch" href="/assets/js/43.a92421aa.js"><link rel="prefetch" href="/assets/js/44.e19be0d2.js"><link rel="prefetch" href="/assets/js/45.def7c4a5.js"><link rel="prefetch" href="/assets/js/46.b4d92a6e.js"><link rel="prefetch" href="/assets/js/47.de8d2dc3.js"><link rel="prefetch" href="/assets/js/48.21f95edd.js"><link rel="prefetch" href="/assets/js/49.26d21bfa.js"><link rel="prefetch" href="/assets/js/5.1bf7576d.js"><link rel="prefetch" href="/assets/js/50.1ea86b8f.js"><link rel="prefetch" href="/assets/js/51.034e7576.js"><link rel="prefetch" href="/assets/js/52.9afafe11.js"><link rel="prefetch" href="/assets/js/53.688c4d83.js"><link rel="prefetch" href="/assets/js/54.13bfb729.js"><link rel="prefetch" href="/assets/js/55.e066dc58.js"><link rel="prefetch" href="/assets/js/56.c036e408.js"><link rel="prefetch" href="/assets/js/57.007d50cf.js"><link rel="prefetch" href="/assets/js/58.3f670fa2.js"><link rel="prefetch" href="/assets/js/59.f41e8ae6.js"><link rel="prefetch" href="/assets/js/6.8cf2a95e.js"><link rel="prefetch" href="/assets/js/60.f0fda430.js"><link rel="prefetch" href="/assets/js/61.ae4987fd.js"><link rel="prefetch" href="/assets/js/62.3c3e0b82.js"><link rel="prefetch" href="/assets/js/63.87900c10.js"><link rel="prefetch" href="/assets/js/64.9ffbb746.js"><link rel="prefetch" href="/assets/js/65.52ffe053.js"><link rel="prefetch" href="/assets/js/66.0b20125c.js"><link rel="prefetch" href="/assets/js/67.cd8a1668.js"><link rel="prefetch" href="/assets/js/68.97020436.js"><link rel="prefetch" href="/assets/js/69.533a79a4.js"><link rel="prefetch" href="/assets/js/7.299203e9.js"><link rel="prefetch" href="/assets/js/70.29933dd9.js"><link rel="prefetch" href="/assets/js/71.f88421fc.js"><link rel="prefetch" href="/assets/js/72.95de2bad.js"><link rel="prefetch" href="/assets/js/73.4a4257cc.js"><link rel="prefetch" href="/assets/js/74.659aab88.js"><link rel="prefetch" href="/assets/js/75.cadd4a65.js"><link rel="prefetch" href="/assets/js/76.254b9f42.js"><link rel="prefetch" href="/assets/js/77.e5b5a87b.js"><link rel="prefetch" href="/assets/js/78.b1b2dd8d.js"><link rel="prefetch" href="/assets/js/79.cbbbe000.js"><link rel="prefetch" href="/assets/js/8.c093787a.js"><link rel="prefetch" href="/assets/js/80.2b85c169.js"><link rel="prefetch" href="/assets/js/81.c6f26762.js"><link rel="prefetch" href="/assets/js/9.010ac11f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8cd2006c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/区块链.html" class="nav-link">
  区块链
</a></div><div class="nav-item"><a href="/英语.html" class="nav-link">
  英语
</a></div><div class="nav-item"><a href="/前端.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/疑问解述篇.html" class="nav-link">
  疑问解述篇
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/区块链.html" class="nav-link">
  区块链
</a></div><div class="nav-item"><a href="/英语.html" class="nav-link">
  英语
</a></div><div class="nav-item"><a href="/前端.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/疑问解述篇.html" class="nav-link">
  疑问解述篇
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>中间件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/中间件/nginx/nginx.html" class="active sidebar-link">nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#下载与安装" class="sidebar-link">下载与安装</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#基本介绍与基本命令" class="sidebar-link">基本介绍与基本命令</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#主配置文件与单配置说明" class="sidebar-link">主配置文件与单配置说明</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#location-匹配规则" class="sidebar-link">location 匹配规则</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#指令介绍" class="sidebar-link">指令介绍</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#rewrite-关键字" class="sidebar-link">rewrite 关键字</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#日志切割配置" class="sidebar-link">日志切割配置</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#第三方模块安装" class="sidebar-link">第三方模块安装</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#反向代理与负载均衡" class="sidebar-link">反向代理与负载均衡</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#nginx-解决跨域" class="sidebar-link">nginx 解决跨域</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#防盗链" class="sidebar-link">防盗链</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#客户端缓存" class="sidebar-link">客户端缓存</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#文件压缩" class="sidebar-link">文件压缩</a></li><li class="sidebar-sub-header"><a href="/java/中间件/nginx/nginx.html#https-协议传输" class="sidebar-link">https 协议传输</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="下载与安装"><a href="#下载与安装" class="header-anchor">#</a> 下载与安装</h2> <h4 id="_1、进入-usr-local-src-目录下执行"><a href="#_1、进入-usr-local-src-目录下执行" class="header-anchor">#</a> 1、进入 /usr/local/src/ 目录下执行: <br></h4> <blockquote><p>下载命令:  <span id="gonglian"> wget http://nginx.org/download/nginx-1.9.0.tar.gz</span></p> <blockquote><p>如出现下图显示 “未找到命令” , 就执行:  <span id="gonglian"> yum -y install wget </span>再接上一步即可
<img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-01.png" alt="An image"></p></blockquote></blockquote> <h4 id="_2、接下再-usr-local-src-目录下有一个-nginx-1-9-0-tar-gz-文件-执行以下"><a href="#_2、接下再-usr-local-src-目录下有一个-nginx-1-9-0-tar-gz-文件-执行以下" class="header-anchor">#</a> 2、接下再 /usr/local/src/ 目录下有一个 nginx-1.9.0.tar.gz 文件, 执行以下: <br></h4> <blockquote><p>解压命令:  <span id="gonglian"> tar -zxvf nginx-1.9.0.tar.gz </span>  到当前文件夹
<img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-02.png" alt="An image"></p></blockquote> <h4 id="_3、cd-到解压后的-nginx-1-9-0-目录-安装-nginx-需要的依赖"><a href="#_3、cd-到解压后的-nginx-1-9-0-目录-安装-nginx-需要的依赖" class="header-anchor">#</a> 3、cd 到解压后的 nginx-1.9.0 目录，安装 nginx 需要的依赖: <br></h4> <blockquote><p>执行:  <span id="gonglian"> yum install -y openssl openssl-devel</span> <br>
执行:  <span id="gonglian"> yum -y install zlib zlib-devel </span><br>
执行:  <span id="gonglian"> yum -y install zlib zlib-devel </span></p></blockquote> <h4 id="_4、nginx-目录下-设置-nginx-安装参数"><a href="#_4、nginx-目录下-设置-nginx-安装参数" class="header-anchor">#</a> 4、nginx 目录下，设置 nginx 安装参数</h4> <blockquote><p>./configure 是源码目录，--prefix 的值是要安装的目录，后面是 nginx 的模块 <br>
执行命令:  <span id="gonglian">./configure --prefix=/usr/local/nginx --with-http_ssl_module</span></p> <blockquote><p>如出现下图红色错误部分，就执行  <span id="gonglian"> yum -y install gcc gcc-c++ autoconf automake make </span>
， 再重复执行上一次命令。
<img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-03.png" alt="An image"></p></blockquote></blockquote> <blockquote><p><img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-04.png" alt="An image"></p></blockquote> <h4 id="_5、nginx-目录下-编译-安装-nginx"><a href="#_5、nginx-目录下-编译-安装-nginx" class="header-anchor">#</a> 5、nginx 目录下，编译 &amp;&amp; 安装 nginx</h4> <blockquote><p>执行命令:  <span id="gonglian"> make &amp;&amp; make install </span></p></blockquote> <h4 id="_6、启动-nginx。进入-nginx-安装的目录-usr-local-nginx-sbin"><a href="#_6、启动-nginx。进入-nginx-安装的目录-usr-local-nginx-sbin" class="header-anchor">#</a> 6、启动 nginx。进入 nginx 安装的目录 /usr/local/nginx/sbin</h4> <blockquote><p>执行命令: <span id="gonglian"> ./nginx</span> <br>
注意: 如主机访问不到虚拟机的 nginx 服务，需要开放虚拟机的端口，参考该教程: <a href="https://jingyan.baidu.com/article/5552ef4796f55e518efbc94f.html" target="_blank">Centos-7 开放端口</a></p></blockquote> <h2 id="基本介绍与基本命令"><a href="#基本介绍与基本命令" class="header-anchor">#</a> 基本介绍与基本命令</h2> <h4 id="基本命令接受"><a href="#基本命令接受" class="header-anchor">#</a> <div class="biaoti2"></div> 基本命令接受</h4> <blockquote><h4 id="进入到-nginx-安装目录下的-sbin-目录"><a href="#进入到-nginx-安装目录下的-sbin-目录" class="header-anchor">#</a> 进入到 nginx 安装目录下的 sbin 目录</h4> <blockquote><p>执行命令: <span id="gonglian"> ./nginx -s stop </span>  停止<br>
执行命令: <span id="gonglian"> ./nginx -s quit </span>      退出<br>
执行命令: <span id="gonglian"> ./nginx -s reload  </span>  重新加载 nginx.conf 核心配置文件<br>
执行命令: <span id="gonglian"> ./nginx -t  </span>  检查配置文件是否有错误 <br>
执行命令: <span id="gonglian"> ./nginx -c /usr/local/nginx/conf/nginx.conf  </span>  指定一个配置文件来启动</p></blockquote></blockquote> <h4 id="文件目录介绍"><a href="#文件目录介绍" class="header-anchor">#</a> <div class="biaoti2"></div> 文件目录介绍</h4> <table><thead><tr><th>目录名称</th> <th style="text-align:center;">介绍</th></tr></thead> <tbody><tr><td>conf</td> <td style="text-align:center;">存放 nginx 需要的配置文件</td></tr> <tr><td>html</td> <td style="text-align:center;">存放静态资源目录</td></tr> <tr><td>logs</td> <td style="text-align:center;">存放日志目录</td></tr> <tr><td>sbin</td> <td style="text-align:center;">存放 nginx 的启动程序</td></tr></tbody></table> <h2 id="主配置文件与单配置说明"><a href="#主配置文件与单配置说明" class="header-anchor">#</a> 主配置文件与单配置说明</h2> <h4 id="nginx-conf-主配置文件详情描述"><a href="#nginx-conf-主配置文件详情描述" class="header-anchor">#</a> <div class="biaoti2"></div> nginx.conf 主配置文件详情描述 <br><br></h4> <div class="nginx-body"><span style="font-size:13px;">#user nobody;</span> <span id="gonglian" style="font-size:13px;">//这声明该 nginx 是哪个用户的，如 # 掉，代表哪个用户都可以。当指明用户时，尽可能是root 级别的<br></span> <span style="font-size:13px;">worker_processes <span class="hong">1</span>;</span> <span id="gonglian" style="font-size:13px;">// 值 1 表示启动一个 worker 线程，一般是服务器是有几个 CPU 那就配置几个 <br></span><br> <span style="font-size:13px;">
#error_log  logs/error.log;  <span id="gonglian" style="font-size:13px;">//这三行表示日志的输出级别, 可以选择性的配置 <br></span>
#error_log  logs/error.log  <span class="hong">notice</span>;  <br>
#error_log  logs/error.log  <span class="hong">info</span>;  <br></span> <p><span style="font-size:13px;">#pid <span class="hong">logs/nginx.pid</span>;</span> <span id="gonglian" style="font-size:13px;">//pid 表示记录 nginx 启动后的进程 id 好。可以到目录文件找到进程号 <br></span></p> <div style="font-size:13px;">
events{<br><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//表示 nginx 在 Liunx 上读取静态资源的线程数, 如不设置。liunx 默认的较少, 高访问时 nginx 会阻塞</span><br> <img class="nginx-img">worker_connections <span class="hong">1024</span>;
</span> <p>}</p></div> <div style="font-size:13px;">
http{<br><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//引入 nginx 相关联的程序文件，而 mime.types 该文件在 nginx 安装/conf/mime.types</span><br> <img class="nginx-img">include <span class="hong">mime.types</span>;
</span><br><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">// nginx 处理文件默认使用的字符集, 也可以更换别的字符集处理</span><br> <img class="nginx-img">default_type <span class="hong">application/octet-stream</span>;
</span><br><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//这是声明日志的变量， 变量名为 mian。以 $ 开头的都是常量皆是 nginx 提高的，可以拼接成一条日志 </span><br> <img class="nginx-img">#log_format <span class="lan"> main</span>  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; ' <br> <img class="nginx-img">#                 <span style="display:inline-block;width:117px;"></span>'$status $body_bytes_sent &quot;$http_referer&quot; '<br> <img class="nginx-img">#                <span style="display:inline-block;width:110px;"></span>  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';
</span><br><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//该表示生成日志，该值是日志将要输出到那个文件下。表示使用 mian 变量的日志格式 </span><br> <img class="nginx-img">#access_log   
 <span class="hong">logs/access.log</span><span class="lan"> main</span>;
</span><br><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//因为文件上传于下载的传输效率很低，而 no 表示 nginx 开启高效传输效率</span><br> <img class="nginx-img">sendfile <span class="hong">no</span>;
</span><br><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//表示客户端连接 nginx, 在 60 毫秒内连不上表示连接超时</span><br> <img class="nginx-img">keepalive_timeout <span class="hong">60</span>;
</span><br><br> <div class="nginx-div"><div style="font-size:13px;">
server{<span id="gonglian" style="font-size:13px;">//配置一个 server 代表一个虚拟主机</span><br><br> <span><img class="nginx-img">listen  <span class="hong">80</span>;
<span id="gonglian" style="font-size:13px;">//表示该虚拟机监听 80 端口</span><br></span><br> <span><img class="nginx-img">server_name  <span class="hong">localhost</span>;
<span id="gonglian" style="font-size:13px;">//表示监听那个域名</span><br></span><br> <span><img class="nginx-img">#access_log  <span class="hong">logs/access.log</span>;
<span id="gonglian" style="font-size:13px;">// 在 server 下配置的与 http 的相同，server 的会覆盖掉 http </span><br></span><br> <div class="nginx-div"><div style="font-size:13px;">
location /{<span id="gonglian" style="font-size:13px;"> // location 是匹配资源的作用, 当输入 guomingcheng.github.io 就会匹配当前的</span><br><br> <span><img class="nginx-img">root  <span class="hong">html</span>;
<span id="gonglian" style="font-size:13px;">// html 是一个目录, 可以使用绝对路径, 也可以是相对路径, 如当前会找到 nginx/html  </span><br></span><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//index 命令只有 url 后面跟着 / 斜杆才有效，index 就是在哪个指定目录下找该文件</span><br> <img class="nginx-img">index   <span class="hong">index.html index.htm;</span>;
</span><br> <p>}</p></div></div> <p>}</p></div></div> <p>}</p></div></div> <h2 id="location-匹配规则"><a href="#location-匹配规则" class="header-anchor">#</a> location 匹配规则</h2> <h4 id="location-路由语法匹配规则"><a href="#location-路由语法匹配规则" class="header-anchor">#</a> <div class="biaoti2"></div> location 路由语法匹配规则 <br><br></h4> <div style="font-size:12px;"><table><thead><tr><th>实列</th> <th style="text-align:left;">名称</th> <th style="text-align:center;">运算符</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td>location /{ root html; }</td> <td style="text-align:left;">普通匹配</td> <td style="text-align:center;"></td> <td style="text-align:center;">普通命中，但是会被正则匹配覆盖掉。优先级最低的</td></tr> <tr><td>location ^~ /b/{ }</td> <td style="text-align:left;">相对匹配</td> <td style="text-align:center;">^~</td> <td style="text-align:center;">也是和普通匹配一样命中，但是不会被正则匹配覆盖掉，优先级只低于精准匹配</td></tr> <tr><td>location = /guo.html{ }</td> <td style="text-align:left;">精准匹配</td> <td style="text-align:center;">=</td> <td style="text-align:center;">精准匹配也就是与 path 完全相等才会命中，优先级最高</td></tr> <tr><td>location ~* /b/{ }</td> <td style="text-align:left;">不区分大小写正则匹配</td> <td style="text-align:center;">~*</td> <td style="text-align:center;">正则匹配只高于普通匹配</td></tr> <tr><td>location ~ /b/{ }</td> <td style="text-align:left;">区分大小写正则匹配</td> <td style="text-align:center;">~</td> <td style="text-align:center;"></td></tr></tbody></table></div> <p><img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-07.png" alt="An image"></p> <h2 id="指令介绍"><a href="#指令介绍" class="header-anchor">#</a> 指令介绍</h2> <h4 id="nginx-指令使用介绍"><a href="#nginx-指令使用介绍" class="header-anchor">#</a> <div class="biaoti2"></div> nginx 指令使用介绍 <br><br></h4> <p>列子 URL : http://www.guomingcheng.com/ming/cheng.html
</p><div style="font-size:12px;"><p></p> <table><thead><tr><th>指令</th> <th style="text-align:left;">作用</th> <th style="text-align:center;">使用</th></tr></thead> <tbody><tr><td>root</td> <td style="text-align:left;">指定静态资源目录</td> <td style="text-align:center;">root 是声明一个 path 路径, 在 nginx 默认时 path 路径是 /usr/local/nginx/html , nginx 是安装目录。root 就是要改过默认的静态资源的路径，另一个作用是：会留下命中的路径，如 location /ming{} 命中会留下路径是 ming/index.html</td></tr> <tr><td>alias</td> <td style="text-align:left;">指定静态资源目录</td> <td style="text-align:center;">也是以 root 相同的都是声明一个 path 路径, 而不同的是会把命中的剔除掉，例如：location /ming{} 命中后留下的路径是 index.html</td></tr> <tr><td>set</td> <td style="text-align:left;">定义一个变量</td> <td style="text-align:center;">在 server 花括号内声明: set $a 33, 这样就是定义了一个变量</td></tr> <tr><td>echo</td> <td style="text-align:left;">输出文本</td> <td style="text-align:center;">这是与 javaEE 中的 resp 响应浏览器一样，但是需要安装模块，这并不是 nginx 默认就有的。安装步骤详见: <a href="nginx-中级.html#miaodian1">echo 模块安装</a></td></tr></tbody></table></div> <h2 id="rewrite-关键字"><a href="#rewrite-关键字" class="header-anchor">#</a> rewrite 关键字</h2> <h4 id="nginx-的请求转发与重定向"><a href="#nginx-的请求转发与重定向" class="header-anchor">#</a> <div class="biaoti2"></div> nginx 的请求转发与重定向 <br><br></h4> <div class="nginx-body"><div style="font-size:13px;">
server{<span id="gonglian" style="font-size:13px;">//配置一个 server 代表一个虚拟主机</span><br><br> <span><img class="nginx-img">listen  <span class="hong">80</span>;
</span><br> <span><img class="nginx-img">server_name  <span class="hong">localhost</span>;
</span><br> <br> <div class="nginx-div"><div style="font-size:13px;">
location /ming/cheng/index.html{<br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;"> //redirect 重定向, ^/ 是正则表达式，表示无论什么字符串都命中。红色值表示将要替换掉命中的字符串。 </span><br> <img class="nginx-img"><span id="gonglian" style="font-size:13px;"> //效果就如：浏览器重新请求 http://location:80/ming/index.html URL</span><br> <img class="nginx-img">rewrite ^/ <span class="hong">/ming/index.html</span> <span class="lan">redirect</span>;
<span id="gonglian" style="font-size:13px;">//  </span><br></span> <p>}</p></div> <div style="font-size:13px;">
location = /ming/index.html{<br> <img class="nginx-img"><span id="gonglian" style="font-size:13px;"> //break 请求转发，红色值会替换掉正则表达式命中的。</span><br> <img class="nginx-img"><span id="gonglian" style="font-size:13px;"> //效果就如：在到 root 声明的 path 下查找 /ming/cheng/index.html 指定的文件</span><br> <span><img class="nginx-img">rewrite ^/ <span class="hong">/ming/cheng/index.html</span> <span class="lan">break</span>;
<span id="gonglian" style="font-size:13px;">//红色是路径, 蓝色是请求转发的关键字 </span><br></span> <span><img class="nginx-img">root  <span class="hong">html</span>;
<span id="gonglian" style="font-size:13px;">//</span><br></span> <p>}</p></div> <div style="font-size:13px;">
location = /ming/index.html{<br> <img class="nginx-img"><span id="gonglian" style="font-size:13px;"> //last 请求转发，红色值会替换掉正则表达式命中的。</span><br> <img class="nginx-img"><span id="gonglian" style="font-size:13px;"> //效果就如：根据替换掉的 path 再一次刷新 location ，重新命中</span><br> <span><img class="nginx-img">rewrite ^/ <span class="hong">/ming/cheng/index.html</span> <span class="lan">last</span>;
<span id="gonglian" style="font-size:13px;">//红色是路径, 蓝色是请求转发的关键字 </span><br></span> <p>}</p></div></div> <p>}</p></div></div> <h2 id="日志切割配置"><a href="#日志切割配置" class="header-anchor">#</a> 日志切割配置</h2> <h4 id="_1、可以在-nginx-conf-文件中定义自己日志格式-如下图片"><a href="#_1、可以在-nginx-conf-文件中定义自己日志格式-如下图片" class="header-anchor">#</a> 1、可以在 nginx.conf 文件中定义自己日志格式, 如下图片:</h4> <blockquote><p><img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-05.png" alt="An image"></p> <blockquote><p>可以使用命令:  <span id="gonglian">tail -f access.log </span>  来实时看日志的打印。access.log 日志的路径
<img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-06.png" alt="An image"></p></blockquote></blockquote> <h4 id="_2、在-nginx-sbin-目录下创建一个可执行文件-编写下面的-xshell-脚本"><a href="#_2、在-nginx-sbin-目录下创建一个可执行文件-编写下面的-xshell-脚本" class="header-anchor">#</a> 2、在 nginx/sbin 目录下创建一个可执行文件，编写下面的 Xshell 脚本</h4> <blockquote><h4 id="文件为-cutting-sh-保存退出"><a href="#文件为-cutting-sh-保存退出" class="header-anchor">#</a> 文件为: cutting.sh , 保存退出</h4> <div class="nginx-body" style="font-size:13px;line-height:23px;"> 
#!/bin/bash<br>
LOG_HOME=&quot;/usr/local/nginx/logs&quot;  <span id="gonglian" style="font-size:13px;">//该值选择自己安装 nginx 路径下的 logs 目录</span><br>
LOG_PATH_BAK=`date +%Y-%m-%d` <br>
mv ${LOG_HOME}/access.log ${LOG_HOME}/access.${LOG_PATH_BAK}.log <br>
mv ${LOG_HOME}/error.log ${LOG_HOME}/error.${LOG_PATH_BAK}.log <br>
kill -USR1 `cat ${LOG_HOME}/nginx.pid` 
</div></blockquote> <blockquote><blockquote><p>当保存退出时该 cutting.sh 还没有可执行权限，需要在当前目录下执行命令为: <br> <span id="gonglian">chmod +x cutting.sh</span><br></p></blockquote></blockquote> <h4 id="_3、在-nginx-sbin-目录下制定配置命令"><a href="#_3、在-nginx-sbin-目录下制定配置命令" class="header-anchor">#</a> 3、在 nginx/sbin 目录下制定配置命令</h4> <blockquote><p>使用命令: crontab -e ,将会打开文件编辑。填写如下文本
</p><div class="nginx-body" style="font-size:13px;line-height:23px;"><span id="gonglian">//五个 * 号从左到右分别是 秒分时天月 。就会执行 cutting.sh </span><br>
00 23 * * * /usr/local/nginx/sbin/cutting.sh  <a href="https://www.cnblogs.com/p0st/p/9482167.html" target="_blank">定时时间参考该教程</a></div><p></p></blockquote> <h2 id="第三方模块安装"><a href="#第三方模块安装" class="header-anchor">#</a> 第三方模块安装</h2> <h4 id="_1、进入-usr-local-src-目录下执行-2"><a href="#_1、进入-usr-local-src-目录下执行-2" class="header-anchor">#</a> 1、进入 /usr/local/src/ 目录下执行: <br></h4> <blockquote><p><span style="font-size:15px;"> 1.1、echo 模块下载命令 </span>: <br><span id="gonglian" style="font-size:13px;">  wget https://github.com/openresty/echo-nginx-module/archive/v0.60.tar.gz</span></p> <blockquote><p>如出现以下字样，就代表模块下载好了
<img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-08.png" alt="An image"></p></blockquote></blockquote> <h4 id="_2、接下再-usr-local-src-目录会有你跟下载模块的-tar-包-执行解压命令"><a href="#_2、接下再-usr-local-src-目录会有你跟下载模块的-tar-包-执行解压命令" class="header-anchor">#</a> 2、接下再 /usr/local/src/ 目录会有你跟下载模块的 tar 包，执行解压命令: <br></h4> <blockquote><p>解压命令:  <span id="gonglian"> tar -zxvf *.tar.gz </span>  到当前文件夹</p></blockquote> <h4 id="_3、进入-nginx-解压后的目录下-编译添加模块"><a href="#_3、进入-nginx-解压后的目录下-编译添加模块" class="header-anchor">#</a> 3、进入 nginx 解压后的目录下，编译添加模块</h4> <blockquote><p><span style="font-size:15px;"> 1.1、echo 模块编译添加 </span>: <br><span id="gonglian" style="font-size:13px;">./configure --add-module=/usr/local/src/echo-nginx-module-0.60 --with-http_ssl_module</span> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-04.png" alt="An image"></p></blockquote> <h4 id="_4、nginx-解压后的目录下-安装-模块命令"><a href="#_4、nginx-解压后的目录下-安装-模块命令" class="header-anchor">#</a> 4、nginx 解压后的目录下，安装 * 模块命令:</h4> <blockquote><p>执行命令:  <span id="gonglian" style="font-size:13px;"> make &amp;&amp; make install </span></p></blockquote> <h4 id="_5、生效问题"><a href="#_5、生效问题" class="header-anchor">#</a> 5、生效问题</h4> <blockquote><p>注意: 如果模块安装没有问题, 但没有生效，那么就先杀死 nginx 服务，再重新开启。</p></blockquote> <h2 id="反向代理与负载均衡"><a href="#反向代理与负载均衡" class="header-anchor">#</a> 反向代理与负载均衡</h2> <ul class="nginx-ul"><li><div>192.168.150.127</div> <div>nginx</div> <div>代理: 静态资源服务器</div></li> <li><div>192.168.150.128</div> <div>tomcat</div> <div>负载: 动态资源服务器</div></li> <li><div>192.168.150.129</div> <div>tomcat</div> <div>负载: 动态资源服务器</div></li> <li><div>192.168.150.126</div> <div>nginx</div> <div>中间站服务器配置</div></li></ul> <br> <h4 id="在-nginx-conf-文件如何配置以及说明"><a href="#在-nginx-conf-文件如何配置以及说明" class="header-anchor">#</a> <div class="biaoti2"></div> 在 nginx.conf 文件如何配置以及说明</h4> <br> <div class="nginx-body"><div style="font-size:13px;">
http{<br><br> <div class="nginx-div"><div style="font-size:13px;">
upstream <span class="lan"> nginx</span>{<span id="gonglian" style="font-size:13px;">// 配置负载服务器, <span class="lan"> nginx</span> 相当是变量, 花括号内可以随意添加 n 机器</span><br> <br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//使用该指令，可以解决 session 问题，但是 weight 会失效。因为他以客户端的 IP 做为键，以一台服务器<img class="nginx-img">作为值，该客户端每次访问都是相当的服务器，session 也将一致，但是宕机了就没办法了</span><br> <img class="nginx-img">#ip_hash; 
</span><br><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//如何不设置 weight 权重，nginx 默认是 1:1 模式轮询, 就现在这样设置, 就表示 128 IP 2 次 余 129<img class="nginx-img"> IP 一次这样轮询</span><br> <img class="nginx-img">server<span class="hong"> 192.168.150.128</span> weight=<span class="lan">2</span>;<br></span> <span><img class="nginx-img">server   <span class="hong">192.168.150.129</span> weight=<span class="lan">1</span>;
</span><br> <p>}</p></div></div> <div class="nginx-div"><div style="font-size:13px;">
server{
<br> <span><img class="nginx-img">listen  <span class="hong">80</span>;
<span id="gonglian" style="font-size:13px;">//表示该虚拟机监听 80 端口</span><br></span> <span><img class="nginx-img">server_name  <span class="hong">localhost</span>;
<span id="gonglian" style="font-size:13px;">//表示监听那个域名</span><br></span><br> <div class="nginx-div"><div style="font-size:13px;">
location /nginx{<br> <span id="gonglian" style="font-size:13px;">// nginx 对应的是上面配置的变量。但需要注意的一点: nginx 后面跟着斜杆就相当 alias , 否则就是 root </span><br> <br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//浏览器输入: http://127.0.0.1/<span class="hong">nginx/tomcat/A131.html</span></span><br> <img class="nginx-img"><span id="gonglian" style="font-size:13px;">//末尾没斜杆: http://192.168.150.128/<span class="hong">nginx/tomcat/A131.html</span></span><br> <img class="nginx-img"><span id="gonglian" style="font-size:13px;">//末尾有斜杆: http://192.168.150.128/<span class="hong">tomcat/A131.html</span></span><br> <img class="nginx-img">proxy_pass  <span class="hong">http://<span class="lan">nginx</span>/</span>;
</span> <br>}
</div></div> <br> <div class="nginx-div"><div style="font-size:13px;"><p>location /130{<br> <span id="gonglian" style="font-size:13px;">//反向代理与负载均衡都是使用 proxy_pass 关键字, 只要端口的后面跟着 / 斜杆, 就是 alias 模式。无论后面有 psth 是否有斜杆无关</span></p> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//浏览器输入: http://127.0.0.1/130/<span class="hong">nginx/A130.html</span></span><br> <img class="nginx-img"><span id="gonglian" style="font-size:13px;">//端口有斜杆: http://192.168.150.130/nginx/<span class="hong">nginx/A130.html</span></span><br> <img class="nginx-img">proxy_pass  <span class="hong">http://192.168.150.127/nginx</span>;
</span> <br>}
</div></div> <p>}</p></div></div> <p>}</p></div></div> <h2 id="nginx-解决跨域"><a href="#nginx-解决跨域" class="header-anchor">#</a> nginx 解决跨域</h2> <h4 id="什么是跨域"><a href="#什么是跨域" class="header-anchor">#</a> <div class="biaoti2"></div>  什么是跨域</h4> <blockquote><p><span style="font-size:13px;">在浏览器有一个同源策略。该策略描述的是，当浏览器请求 www.mingcheng.com 域名时返回一个 HTML 页面</span> <span style="font-size:13px;">，在该页面使用 ajax 请求别的如 www.guomingcheng.com 下的 json 数据时，这样不同域名就会产生跨域，不止域名不同产生跨域，当一个 url的协议、域名、端口三者之间任意一个与当前页面 url 不同即为跨域，如下图：</span> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-09.png" alt="An image"></p></blockquote> <blockquote><blockquote><p><span style="font-size:13px;">当浏览器发现请求的域名不同时, request 会携带一个字段 Origin 值为来源网址 www.mingcheng.com , 如下:</span> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-10.png" alt="An image"> <span style="font-size:13px;"> 如果想要 www.mingcheng.com 请求成功，web 服务需要在 response 时，设置 Access-Control-Allow-Origin 字段的值为 www.mingcheng.com , 当浏览器检查该字段的值是  www.mingcheng.com , 就代表目标 web 服务信任该域名。这样就可以解决跨域了。</span> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-11.png" alt="An image"></p></blockquote></blockquote> <h4 id="解决跨域"><a href="#解决跨域" class="header-anchor">#</a> <div class="biaoti2"></div>  解决跨域</h4> <br> <div class="nginx-body"><div style="font-size:13px;">
http{<br><br> <div class="nginx-div"><div style="font-size:13px;">
server{
<br><br> <span><img class="nginx-img">listen  <span class="hong">80</span>;
<span id="gonglian" style="font-size:13px;">//表示该虚拟机监听 80 端口</span><br></span> <span><img class="nginx-img">server_name  <span class="hong">www.guomingcheng.com</span>;
<span id="gonglian" style="font-size:13px;">//表示监听那个域名</span><br></span><br> <span><img class="nginx-img">if($http_origin = http://www.mingcheng.com){<br> <img class="nginx-img"> <img class="nginx-img">set <span class="lan">$allow_url</span> $http_origin;<br> <img class="nginx-img">}  
</span><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//是否允许请求带有验证信息</span><br> <img class="nginx-img">add_header Access-Control-Allow-Credentials <span class="hong">true</span>;
</span><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;">//允许跨域访问的域名，可以是多个一列，也可以使用 * , * 代表着那个域名都可以</span><br> <img class="nginx-img">add_header Access-Control-Allow-Origin <span class="lan">$allow_url</span>;
</span><br> <div class="nginx-div"><div style="font-size:13px;"><p>location /tomcat{<br></p> <span></span>}
</div></div> <p>}</p></div></div>
}
</div></div> <h2 id="防盗链"><a href="#防盗链" class="header-anchor">#</a> 防盗链</h2> <h4 id="让静态资源只在自己域名下的-html-离显示"><a href="#让静态资源只在自己域名下的-html-离显示" class="header-anchor">#</a> <div class="biaoti2"></div>  让静态资源只在自己域名下的 html 离显示</h4> <blockquote><p><span id="gonglian" style="font-size:13px;">valiad_referers: 是匹配域名的白名单，如果不匹配，那么 nginx 就把内置变量 $valid_referer 设置为 1，就会进入 if 快返回 404。校验的值就是浏览器传入来的 Referer 字段的值，该值表示当前请求来自哪的域名下的，如下图:</span><br> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-14.png" alt="An image"><br> <span id="gonglian" style="font-size:13px;"> valiad_referers 的值: 是一个正则表达式, 可根据你写的正则来配置多个白名单  </span></p></blockquote> <div class="nginx-body"><div style="font-size:13px;">
http{<br><br> <div class="nginx-div"><div style="font-size:13px;">
server{
<br><br> <span><img class="nginx-img">listen  <span class="hong">80</span>;
<span id="gonglian" style="font-size:13px;">//表示该虚拟机监听 80 端口</span><br></span> <span><img class="nginx-img">server_name  <span class="hong">www.guomingcheng.com</span>;
<span id="gonglian" style="font-size:13px;">//表示监听那个域名</span><br></span><br> <div class="nginx-div"><div style="font-size:13px;"><p>location /tomcat{<br></p> <span><img class="nginx-img">valid_referers  <span class="hong">www.guomingcheng.com</span>;
</span><br> <span><img class="nginx-img">if($invalid_referer){<br> <img class="nginx-img"> <img class="nginx-img">return <span class="hong">404</span> ;<br> <img class="nginx-img">}  
</span><br> <br> <span><img class="nginx-img">root  <span class="hong">html/static</span>;
</span><br> <span></span>}
</div></div> <p>}</p></div></div>
}
</div></div> <h2 id="客户端缓存"><a href="#客户端缓存" class="header-anchor">#</a> 客户端缓存</h2> <h4 id="让服务器减少带宽"><a href="#让服务器减少带宽" class="header-anchor">#</a> <div class="biaoti2"></div> 让服务器减少带宽</h4> <blockquote><p><span id="gonglian" style="font-size:13px;"> expires 是缓存关键字, 他告诉浏览器该 location 下的静态资源你可以在本地缓存多少时间 </span><br> <span id="gonglian" style="font-size:13px;"> 时间单位: [2s = 2秒钟] [2m = 2分钟钟] [2h = 3小时] [2d = 天]  </span></p></blockquote> <div class="nginx-body"><div style="font-size:13px;">
http{<br><br> <div class="nginx-div"><div style="font-size:13px;">
server{
<br><br> <span><img class="nginx-img">listen  <span class="hong">80</span>;
<span id="gonglian" style="font-size:13px;">//表示该虚拟机监听 80 端口</span><br></span> <span><img class="nginx-img">server_name  <span class="hong">www.guomingcheng.com</span>;
<span id="gonglian" style="font-size:13px;">//表示监听那个域名</span><br></span> <div class="nginx-div"><div style="font-size:13px;"><p>location ^~ /tomcat{<br></p> <span><img class="nginx-img">expires  <span class="hong">2s</span>;
</span><br> <span><img class="nginx-img">root  <span class="hong">html/static</span>;
</span><br> <span></span>}
</div></div> <p>}</p></div></div>
}
</div></div> <h2 id="文件压缩"><a href="#文件压缩" class="header-anchor">#</a> 文件压缩</h2> <h4 id="压缩传输的数据-让服务器减少带宽资源"><a href="#压缩传输的数据-让服务器减少带宽资源" class="header-anchor">#</a> <div class="biaoti2"></div> 压缩传输的数据，让服务器减少带宽资源</h4> <blockquote><p><span id="gonglian" style="font-size:13px;"> 浏览器与 nginx 交互时，当一个 url 请求 nginx 是，浏览器会携带自身支持解压缩类型的值一并传：如下图: </span><br> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-12.png" alt="An image"><br> <span id="gonglian" style="font-size:13px;"> nginx 可选用浏览器能解压的类型进行对文件压缩，也并携带返回，让浏览器根据那个类型来解压: </span><br> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-13.png" alt="An image"></p></blockquote> <div class="nginx-body"><div style="font-size:13px;">
http{<br><br> <div class="nginx-div"><div style="font-size:13px;">
server{
<br><br> <span><img class="nginx-img">listen  <span class="hong">80</span>;
<span id="gonglian" style="font-size:13px;">//表示该虚拟机监听 80 端口</span><br></span> <span><img class="nginx-img">server_name  <span class="hong">www.guomingcheng.com</span>;
<span id="gonglian" style="font-size:13px;">//表示监听那个域名</span><br></span> <div class="nginx-div"><div style="font-size:13px;"><p>location ~ /(.*).(html|js|css|jpg|jpeg|png|gif)${ <span id="gonglian" style="font-size:13px;">//url 的后缀只要是书写的都能匹配</span><br></p> <span><img class="nginx-img">gzip <span class="hong">on</span>; <span id="gonglian" style="font-size:13px;"># on 是启用 gzip , 默认是 off 不启用</span><br></span><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;"># 表示 js、css、html、jpg、png、gif 的格式文件启用 gzip 压缩功能</span><br> <img class="nginx-img">gzip_types  <span class="hong">application/javascript text/css image/jpeg image/png image/gif</span>;
</span><br> <span><img class="nginx-img">gzip_min_length  <span class="hong">10</span> <span id="gonglian" style="font-size:13px;">#10 是压缩文件的最小值，小于该值得文件不会压缩</span>;
</span><br> <span><img class="nginx-img">gzip_buffers  <span class="hong">4 1k</span><span id="gonglian" style="font-size:13px;"> #设置压缩响应的缓冲区的个数与大小，默认是内存一页的大小</span>;
</span><br> <span><img class="nginx-img">gzip_comp_level  <span class="hong">1</span> <span id="gonglian" style="font-size:13px;">#压缩级别，取值范围是 1--9 ，值越大压缩的比率就越大，但会耗费 cpu 的时间</span>;
</span><br><br> <span><img class="nginx-img">root  <span class="hong">html/static</span>;
</span><br> <span></span>}
</div></div> <p>}</p></div></div>
}
</div></div> <h2 id="https-协议传输"><a href="#https-协议传输" class="header-anchor">#</a> https 协议传输</h2> <h4 id="让数据传输之间更加安全"><a href="#让数据传输之间更加安全" class="header-anchor">#</a> <div class="biaoti2"></div> 让数据传输之间更加安全</h4> <blockquote><p><span id="gonglian" style="font-size:13px;"> https 协议需要的证书文件与私钥文件，是在阿里云申请时会有这俩个文件，只需要存放在对应的路径就行，阿里云申请的也是验证过的。但是: 没有公司是不能申请验证的，所有就需要生成一个假的验证，先看看 https 协议的效果。</span><br> <br> <span id="gonglian" style="font-size:13px;"> cd 到 /usr/local/nginx/https/ 目录下，生成证书。 </span><br></p> <blockquote><p><span style="font-size:13px;"> 1、创建私钥文件--命令为: <span id="gonglian" style="font-size:13px;"> openssl genrsa -des3 -out <span class="lan">server.key </span> 1024 </span></span><br></p> <blockquote><p><span style="font-size:13px;"> 1.1会提示你输入私钥密码，如图下: </span><br> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-15.png" alt="An image"></p></blockquote></blockquote></blockquote> <blockquote><blockquote><p><span style="font-size:13px;"> 2、创建签名证书文件--命令为: <span id="gonglian" style="font-size:13px;"> openssl req -new -key <span class="lan">server.key </span>  -out  <span class="lan">server.csr  </span></span></span><br></p> <blockquote><p><span style="font-size:13px;"> 2.1这还不是目标证书，这里需要用到 <span class="lan">server.key </span> 私钥文件，但这个私钥有密码的它会提示你输入密码:</span><br> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-16.png" alt="An image"> <span style="font-size:13px;"> 2.2接着会让你输入各种信息，按着说明输入即可: </span><br> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-17.png" alt="An image"></p></blockquote></blockquote></blockquote> <blockquote><blockquote><p><span style="font-size:13px;"> 3、创建一个没有密码的私钥文件--命令为:  <span id="gonglian" style="font-size:13px;"> openssl rsa -in <span class="lan">server.key </span> -out  <span class="lan">server_nopass.key</span></span></span><br></p> <blockquote><p><span style="font-size:13px;"> 3.1这个就是把有密码的私钥文件复制一份，但剔除密码，但还是提示你输入密码:  </span><br> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-18.png" alt="An image"></p></blockquote></blockquote></blockquote> <blockquote><blockquote><p><span style="font-size:13px;"> 4、创建目标证书文件--命令为: <br><span id="gonglian" style="font-size:13px;"> openssl x509 -req -days 365 -in <span class="lan">server.csr </span>  -signkey  <span class="lan">server_nopass.key </span>  -out <span class="lan"> server.crt </span></span></span><br> <img src="/img/java/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/nginx-18.png" alt="An image"></p></blockquote></blockquote> <h4 id="配置-server-的-https"><a href="#配置-server-的-https" class="header-anchor">#</a> <div class="biaoti2"></div> 配置 server 的 https</h4> <br> <div class="nginx-body"><div style="font-size:13px;">
http{<br><br> <div class="nginx-div"><div style="font-size:13px;">
server{
<br><br> <span><img class="nginx-img">listen  <span class="hong">80</span>;
<span id="gonglian" style="font-size:13px;"></span><br></span> <span><img class="nginx-img">server_name  <span class="hong">www.guomingcheng.com</span>;
<span id="gonglian" style="font-size:13px;"></span><br></span><br> <span><img class="nginx-img">rewrite ^/  <span class="hong">https://www.mingcheng.com:443</span> <span class="lan">redirect</span>;
<span id="gonglian" style="font-size:13px;"># 让用户服务 http 时重定向到 https 中</span><br></span> <div class="nginx-div"><div style="font-size:13px;"><p>location ~ /(.*).(html|js|css|jpg|jpeg|png|gif)${ <span id="gonglian" style="font-size:13px;">//url 的后缀只要是书写的都能匹配</span><br></p> <span><img class="nginx-img">root  <span class="hong">html/static</span>;
</span><br> <span></span>}
</div></div> <p>}</p></div> <div style="font-size:13px;">
server{
<br><br> <span><img class="nginx-img">listen  <span class="hong">443 ssl</span>;
<span id="gonglian" style="font-size:13px;">//https 协议默认监听的是 443 端口</span><br></span> <span><img class="nginx-img">server_name  <span class="hong">www.guomingcheng.com</span>;
<span id="gonglian" style="font-size:13px;">//表示监听那个域名</span><br></span><br> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;"># 证书文件，</span><br> <img class="nginx-img">ssl_certificate     <span class="hong">/usr/local/nginx/https/server.crt</span>;<br></span> <span><img class="nginx-img"><span id="gonglian" style="font-size:13px;"># 服务器私钥文件</span><br> <img class="nginx-img">ssl_certificate_key  <span class="hong">/usr/local/nginx/https/server_nopass.key</span>;<br></span> <div class="nginx-div"><div style="font-size:13px;"><p>location ~ /(.*).(html|js|css|jpg|jpeg|png|gif)${ <span id="gonglian" style="font-size:13px;">//url 的后缀只要是书写的都能匹配</span><br></p> <span><img class="nginx-img">root  <span class="hong">html/static</span>;
</span><br> <span></span>}
</div></div> <p>}</p></div></div>
}
</div></div> <h4 id="以上所有步骤都配置好了-但需要注意俩点-如下"><a href="#以上所有步骤都配置好了-但需要注意俩点-如下" class="header-anchor">#</a> <div class="biaoti2"></div> 以上所有步骤都配置好了，但需要注意俩点，如下</h4> <blockquote><blockquote><p>1、确认是开发 443 端口，端口开发参考教程:  <a href="https://jingyan.baidu.com/article/5552ef4796f55e518efbc94f.html" target="_blank">Centos-7 开放端口</a><br>
2、在 https 协议传输的文件，不能使用 ajxa 请求 http 协议的数据</p></blockquote></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/java/框架/springboot/springboot.html" class="prev">
        springBoot
      </a></span> <span class="next"><a href="/java/数据库/mysql/mysql.html">
        mysql
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ce1393de.js" defer></script><script src="/assets/js/2.ee68cb5d.js" defer></script><script src="/assets/js/12.aa5ec6e6.js" defer></script>
  </body>
</html>
